import{I as G,e as te,a7 as j,h as L,l as U,A as fe,d as ie,g as X,i as se,j as le,k as $,m as V,q as R,C as oe,a8 as ue,a9 as K,B as ce,aa as w,J,ab as de,L as pe,ac as ve,ad as he,ae as Q,af as ge,ag as me,ah as _e,a6 as W,ai as Ee,D as ee,G as ae,aj as Y,Q as Ne,ak as we,al as Ae,am as Te,F as Ie,v as xe,an as Se,u as F}from"./D_Cuz1bJ.js";import{g as H,s as M,a as ke,t as De}from"./C-NbWmbW.js";import{p as be}from"./DSKcd4hf.js";function ze(e,t){return t}function Ce(e,t,r){for(var o=[],c=t.length,n,l=t.length,m=0;m<c;m++){let N=t[m];ae(N,()=>{if(n){if(n.pending.delete(N),n.done.add(N),n.pending.size===0){var u=e.outrogroups;P(Q(n.done)),u.delete(n),u.size===0&&(e.outrogroups=null)}}else l-=1},!1)}if(l===0){var s=o.length===0&&r!==null;if(s){var d=r,f=d.parentNode;Te(f),f.append(d),e.items.clear()}P(t,!s)}else n={pending:new Set(t),done:new Set},(e.outrogroups??=new Set).add(n)}function P(e,t=!0){for(var r=0;r<e.length;r++)Ie(e[r],t)}var Z;function qe(e,t,r,o,c,n=null){var l=e,m=new Map,s=(t&j)!==0;if(s){var d=e;l=L?U(fe(d)):d.appendChild(G())}L&&ie();var f=null,N=ve(()=>{var i=r();return he(i)?i:i==null?[]:Q(i)}),u,h=!0;function T(){a.fallback=f,Le(a,u,l,t,o),f!==null&&(u.length===0?(f.f&w)===0?ee(f):(f.f^=w,O(f,null,l)):ae(f,()=>{f=null}))}var S=te(()=>{u=X(N);var i=u.length;let k=!1;if(L){var D=se(l)===le;D!==(i===0)&&(l=$(),U(l),V(!1),k=!0)}for(var E=new Set,I=ce,b=pe(),_=0;_<i;_+=1){L&&R.nodeType===oe&&R.data===ue&&(l=R,k=!0,V(!1));var x=u[_],C=o(x,_),p=h?null:m.get(C);p?(p.v&&K(p.v,x),p.i&&K(p.i,_),b&&I.unskip_effect(p.e)):(p=ye(m,h?l:Z??=G(),x,C,_,c,t,r),h||(p.e.f|=w),m.set(C,p)),E.add(C)}if(i===0&&n&&!f&&(h?f=J(()=>n(l)):(f=J(()=>n(Z??=G())),f.f|=w)),i>E.size&&de(),L&&i>0&&U($()),!h)if(b){for(const[re,ne]of m)E.has(re)||I.skip_effect(ne.e);I.oncommit(T),I.ondiscard(()=>{})}else T();k&&V(!0),X(N)}),a={effect:S,items:m,outrogroups:null,fallback:f};h=!1,L&&(l=R)}function y(e){for(;e!==null&&(e.f&we)===0;)e=e.next;return e}function Le(e,t,r,o,c){var n=(o&Ae)!==0,l=t.length,m=e.items,s=y(e.effect.first),d,f=null,N,u=[],h=[],T,S,a,i;if(n)for(i=0;i<l;i+=1)T=t[i],S=c(T,i),a=m.get(S).e,(a.f&w)===0&&(a.nodes?.a?.measure(),(N??=new Set).add(a));for(i=0;i<l;i+=1){if(T=t[i],S=c(T,i),a=m.get(S).e,e.outrogroups!==null)for(const p of e.outrogroups)p.pending.delete(a),p.done.delete(a);if((a.f&w)!==0)if(a.f^=w,a===s)O(a,null,r);else{var k=f?f.next:s;a===e.effect.last&&(e.effect.last=a.prev),a.prev&&(a.prev.next=a.next),a.next&&(a.next.prev=a.prev),A(e,f,a),A(e,a,k),O(a,k,r),f=a,u=[],h=[],s=y(f.next);continue}if((a.f&Y)!==0&&(ee(a),n&&(a.nodes?.a?.unfix(),(N??=new Set).delete(a))),a!==s){if(d!==void 0&&d.has(a)){if(u.length<h.length){var D=h[0],E;f=D.prev;var I=u[0],b=u[u.length-1];for(E=0;E<u.length;E+=1)O(u[E],D,r);for(E=0;E<h.length;E+=1)d.delete(h[E]);A(e,I.prev,b.next),A(e,f,I),A(e,b,D),s=D,f=b,i-=1,u=[],h=[]}else d.delete(a),O(a,s,r),A(e,a.prev,a.next),A(e,a,f===null?e.effect.first:f.next),A(e,f,a),f=a;continue}for(u=[],h=[];s!==null&&s!==a;)(d??=new Set).add(s),h.push(s),s=y(s.next);if(s===null)continue}(a.f&w)===0&&u.push(a),f=a,s=y(a.next)}if(e.outrogroups!==null){for(const p of e.outrogroups)p.pending.size===0&&(P(Q(p.done)),e.outrogroups?.delete(p));e.outrogroups.size===0&&(e.outrogroups=null)}if(s!==null||d!==void 0){var _=[];if(d!==void 0)for(a of d)(a.f&Y)===0&&_.push(a);for(;s!==null;)(s.f&Y)===0&&s!==e.fallback&&_.push(s),s=y(s.next);var x=_.length;if(x>0){var C=(o&j)!==0&&l===0?r:null;if(n){for(i=0;i<x;i+=1)_[i].nodes?.a?.measure();for(i=0;i<x;i+=1)_[i].nodes?.a?.fix()}Ce(e,_,C)}}n&&Ne(()=>{if(N!==void 0)for(a of N)a.nodes?.a?.apply()})}function ye(e,t,r,o,c,n,l,m){var s=(l&ge)!==0?(l&me)===0?_e(r,!1,!1):W(r):null,d=(l&Ee)!==0?W(c):null;return{v:s,i:d,e:J(()=>(n(t,s??r,d??c,m),()=>{e.delete(o)}))}}function O(e,t,r){if(e.nodes)for(var o=e.nodes.start,c=e.nodes.end,n=t&&(t.f&w)===0?t.nodes.start:r;o!==null;){var l=xe(o);if(n.before(o),o===c)return;o=l}}function A(e,t,r){t===null?e.effect.first=r:t.next=r,r===null?e.effect.last=t:r.prev=t}let g=Se({selectedTopic:"",selectedNoteName:"",selectedNoteId:"",cursorState:{}});(async()=>(g.selectedTopic=await H("selectedTopic")||"",g.selectedNoteName=await H("selectedNoteName")||"",g.selectedNoteId=await H("selectedNoteId")||"",g.cursorState=await H("cursorState")||{}))();function Be(){F(()=>{g.selectedTopic&&M("selectedTopic",g.selectedTopic)}),F(()=>{g.selectedNoteName&&M("selectedNoteName",g.selectedNoteName)}),F(()=>{g.selectedNoteId&&M("selectedNoteId",g.selectedNoteId)}),F(()=>{g.cursorState&&M("cursorState",ke(g.cursorState))})}function Ge(){let e=be.url.pathname.split("/").filter(Boolean);return e.unshift(De.triliumUrl),e.includes("topic")&&e.splice(e.indexOf("topic"),1,g.selectedTopic),e.includes("note")&&(e.splice(e.indexOf("note"),0,g.selectedTopic),e.splice(e.indexOf("note"),1,g.selectedNoteName)),e}let q=[],B=[];function Oe(e){q=q.filter(t=>t!==e)}function Ue(e){return q.push(e),()=>Oe(e)}function Re(e){B=B.filter(t=>t!==e)}function Ve(e){return B.push(e),()=>Re(e)}function v(e){q.forEach(t=>t(e))}function z(e){B.forEach(t=>t(e))}function Ye(){window.addEventListener("keydown",r=>{r.key=="ArrowUp"?(r.preventDefault(),v("up")):r.key=="ArrowDown"?(r.preventDefault(),v("down")):r.key=="ArrowLeft"?(r.preventDefault(),v("left")):r.key=="ArrowRight"?(r.preventDefault(),v("right")):r.key=="Enter"?(r.preventDefault(),v("confirm")):r.key=="Escape"&&(r.preventDefault(),v("cancel"))});let e={},t=()=>{var r=navigator.getGamepads();for(let o of r)o?.buttons&&(o.axes.forEach((c,n)=>{n==0&&z({axis:"lx",value:c}),n==1&&z({axis:"ly",value:c}),n==2&&z({axis:"rx",value:c}),n==3&&z({axis:"ry",value:c})}),o.buttons.forEach((c,n)=>{c.pressed?e[n]||(console.log("Pressed: "+n),n==8&&v("cancel"),n==1&&v("confirm"),n==4&&v("l1"),n==5&&v("r1"),n==6&&v("l2"),n==7&&v("r2"),n==12&&v("up"),n==13&&v("down"),n==14&&v("left"),n==15&&v("right"),e[n]=!0):e[n]=!1}));requestAnimationFrame(t)};requestAnimationFrame(t)}export{Ue as a,g as b,Ve as c,Ye as d,qe as e,Be as f,Ge as g,ze as i};
