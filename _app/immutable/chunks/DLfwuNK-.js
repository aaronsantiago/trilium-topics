import{U as O,x as ee,aa as K,o as N,B as z,P as ne,w as re,g as P,y as fe,z as ae,A as X,C as q,G as R,I as ie,ab as le,ac as Y,n as te,ad as A,V as G,ae as ue,X as se,af as oe,ag as ve,ah as V,ai as de,aj as ce,ak as pe,a2 as J,al as he,Q as W,T as Z,am as B,q as ge,an as _e,ao as Ee,ap as me,R as Ae,J as we}from"./BookdCrg.js";function Ce(e,a){return a}function ke(e,a,n){for(var o=[],d=a.length,f,u=a.length,g=0;g<d;g++){let m=a[g];Z(m,()=>{if(f){if(f.pending.delete(m),f.done.add(m),f.pending.size===0){var v=e.outrogroups;U(V(f.done)),v.delete(f),v.size===0&&(e.outrogroups=null)}}else u-=1},!1)}if(u===0){var t=o.length===0&&n!==null;if(t){var c=n,i=c.parentNode;me(i),i.append(c),e.items.clear()}U(a,!t)}else f={pending:new Set(a),done:new Set},(e.outrogroups??=new Set).add(f)}function U(e,a=!0){for(var n=0;n<e.length;n++)Ae(e[n],a)}var Q;function Se(e,a,n,o,d,f=null){var u=e,g=new Map,t=(a&K)!==0;if(t){var c=e;u=N?z(ne(c)):c.appendChild(O())}N&&re();var i=null,m=oe(()=>{var l=n();return ve(l)?l:l==null?[]:V(l)}),v,h=!0;function k(){r.fallback=i,xe(r,v,u,a,o),i!==null&&(v.length===0?(i.f&A)===0?W(i):(i.f^=A,L(i,null,u)):Z(i,()=>{i=null}))}var I=ee(()=>{v=P(m);var l=v.length;let T=!1;if(N){var y=fe(u)===ae;y!==(l===0)&&(u=X(),z(u),q(!1),T=!0)}for(var E=new Set,x=te,C=se(),_=0;_<l;_+=1){N&&R.nodeType===ie&&R.data===le&&(u=R,T=!0,q(!1));var D=v[_],S=o(D,_),p=h?null:g.get(S);p?(p.v&&Y(p.v,D),p.i&&Y(p.i,_),C&&x.unskip_effect(p.e)):(p=De(g,h?u:Q??=O(),D,S,_,d,a,n),h||(p.e.f|=A),g.set(S,p)),E.add(S)}if(l===0&&f&&!i&&(h?i=G(()=>f(u)):(i=G(()=>f(Q??=O())),i.f|=A)),l>E.size&&ue(),N&&l>0&&z(X()),!h)if(C){for(const[$,j]of g)E.has($)||x.skip_effect(j.e);x.oncommit(k),x.ondiscard(()=>{})}else k();T&&q(!0),P(m)}),r={effect:I,items:g,outrogroups:null,fallback:i};h=!1,N&&(u=R)}function b(e){for(;e!==null&&(e.f&_e)===0;)e=e.next;return e}function xe(e,a,n,o,d){var f=(o&Ee)!==0,u=a.length,g=e.items,t=b(e.effect.first),c,i=null,m,v=[],h=[],k,I,r,l;if(f)for(l=0;l<u;l+=1)k=a[l],I=d(k,l),r=g.get(I).e,(r.f&A)===0&&(r.nodes?.a?.measure(),(m??=new Set).add(r));for(l=0;l<u;l+=1){if(k=a[l],I=d(k,l),r=g.get(I).e,e.outrogroups!==null)for(const p of e.outrogroups)p.pending.delete(r),p.done.delete(r);if((r.f&A)!==0)if(r.f^=A,r===t)L(r,null,n);else{var T=i?i.next:t;r===e.effect.last&&(e.effect.last=r.prev),r.prev&&(r.prev.next=r.next),r.next&&(r.next.prev=r.prev),w(e,i,r),w(e,r,T),L(r,T,n),i=r,v=[],h=[],t=b(i.next);continue}if((r.f&B)!==0&&(W(r),f&&(r.nodes?.a?.unfix(),(m??=new Set).delete(r))),r!==t){if(c!==void 0&&c.has(r)){if(v.length<h.length){var y=h[0],E;i=y.prev;var x=v[0],C=v[v.length-1];for(E=0;E<v.length;E+=1)L(v[E],y,n);for(E=0;E<h.length;E+=1)c.delete(h[E]);w(e,x.prev,C.next),w(e,i,x),w(e,C,y),t=y,i=C,l-=1,v=[],h=[]}else c.delete(r),L(r,t,n),w(e,r.prev,r.next),w(e,r,i===null?e.effect.first:i.next),w(e,i,r),i=r;continue}for(v=[],h=[];t!==null&&t!==r;)(c??=new Set).add(t),h.push(t),t=b(t.next);if(t===null)continue}(r.f&A)===0&&v.push(r),i=r,t=b(r.next)}if(e.outrogroups!==null){for(const p of e.outrogroups)p.pending.size===0&&(U(V(p.done)),e.outrogroups?.delete(p));e.outrogroups.size===0&&(e.outrogroups=null)}if(t!==null||c!==void 0){var _=[];if(c!==void 0)for(r of c)(r.f&B)===0&&_.push(r);for(;t!==null;)(t.f&B)===0&&t!==e.fallback&&_.push(t),t=b(t.next);var D=_.length;if(D>0){var S=(o&K)!==0&&u===0?n:null;if(f){for(l=0;l<D;l+=1)_[l].nodes?.a?.measure();for(l=0;l<D;l+=1)_[l].nodes?.a?.fix()}ke(e,_,S)}}f&&ge(()=>{if(m!==void 0)for(r of m)r.nodes?.a?.apply()})}function De(e,a,n,o,d,f,u,g){var t=(u&de)!==0?(u&ce)===0?pe(n,!1,!1):J(n):null,c=(u&he)!==0?J(d):null;return{v:t,i:c,e:G(()=>(f(a,t??n,c??d,g),()=>{e.delete(o)}))}}function L(e,a,n){if(e.nodes)for(var o=e.nodes.start,d=e.nodes.end,f=a&&(a.f&A)===0?a.nodes.start:n;o!==null;){var u=we(o);if(f.before(o),o===d)return;o=u}}function w(e,a,n){a===null?e.effect.first=n:a.next=n,n===null?e.effect.last=a:n.prev=a}let H=[],M=[];function Ie(e){H=H.filter(a=>a!==e)}function Ne(e){return H.push(e),()=>Ie(e)}function Te(e){M=M.filter(a=>a!==e)}function be(e){return M.push(e),()=>Te(e)}function s(e){H.forEach(a=>a(e))}function F(e){M.forEach(a=>a(e))}function Le(){window.addEventListener("keydown",n=>{n.key=="3"&&(s("l2"),n.preventDefault()),n.key=="4"&&(s("l1"),n.preventDefault()),n.key=="7"&&(s("r1"),n.preventDefault()),n.key=="8"&&(s("r2"),n.preventDefault()),n.key=="0"&&(s("delete"),n.preventDefault()),n.key=="ArrowUp"?(n.preventDefault(),s("up")):n.key=="ArrowDown"?(n.preventDefault(),s("down")):n.key=="ArrowLeft"?(n.preventDefault(),s("left")):n.key=="ArrowRight"?(n.preventDefault(),s("right")):n.key=="Enter"?(n.preventDefault(),s("confirm")):n.key=="Escape"&&(n.preventDefault(),s("cancel"))});let e={},a=()=>{var n=navigator.getGamepads();for(let o of n)o?.buttons&&(o.axes.forEach((d,f)=>{f==0&&F({axis:"lx",value:d}),f==1&&F({axis:"ly",value:d}),f==2&&F({axis:"rx",value:d}),f==3&&F({axis:"ry",value:d})}),o.buttons.forEach((d,f)=>{d.pressed?e[f]||(console.log("Pressed: "+f),f==8&&s("cancel"),f==1&&s("confirm"),f==3&&s("delete"),f==4&&s("l1"),f==5&&s("r1"),f==6&&s("l2"),f==7&&s("r2"),f==10&&s("l3"),f==12&&s("up"),f==13&&s("down"),f==14&&s("left"),f==15&&s("right"),e[f]=!0):e[f]=!1}));requestAnimationFrame(a)};requestAnimationFrame(a)}export{Ne as a,be as b,Le as c,Se as e,Ce as i};
