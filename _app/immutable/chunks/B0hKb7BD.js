import{I as G,e as te,a7 as j,h as C,l as U,A as fe,d as ie,g as X,i as le,j as se,k as $,m as V,q as R,C as oe,a8 as ue,a9 as K,B as ce,aa as w,J,ab as de,L as pe,ac as ve,ad as he,ae as Q,af as ge,ag as me,ah as _e,a6 as W,ai as Ee,D as ee,G as ae,aj as Y,Q as Ne,ak as we,al as Ae,am as Te,F as Ie,v as xe,an as Se,u as F}from"./D_Cuz1bJ.js";import{g as H,s as M,a as ke,t as De}from"./C-NbWmbW.js";import{p as be}from"./CHLGN790.js";function ze(e,t){return t}function ye(e,t,a){for(var u=[],d=t.length,n,s=t.length,m=0;m<d;m++){let N=t[m];ae(N,()=>{if(n){if(n.pending.delete(N),n.done.add(N),n.pending.size===0){var c=e.outrogroups;P(Q(n.done)),c.delete(n),c.size===0&&(e.outrogroups=null)}}else s-=1},!1)}if(s===0){var l=u.length===0&&a!==null;if(l){var p=a,f=p.parentNode;Te(f),f.append(p),e.items.clear()}P(t,!l)}else n={pending:new Set(t),done:new Set},(e.outrogroups??=new Set).add(n)}function P(e,t=!0){for(var a=0;a<e.length;a++)Ie(e[a],t)}var Z;function qe(e,t,a,u,d,n=null){var s=e,m=new Map,l=(t&j)!==0;if(l){var p=e;s=C?U(fe(p)):p.appendChild(G())}C&&ie();var f=null,N=ve(()=>{var i=a();return he(i)?i:i==null?[]:Q(i)}),c,h=!0;function T(){r.fallback=f,Ce(r,c,s,t,u),f!==null&&(c.length===0?(f.f&w)===0?ee(f):(f.f^=w,O(f,null,s)):ae(f,()=>{f=null}))}var S=te(()=>{c=X(N);var i=c.length;let k=!1;if(C){var D=le(s)===se;D!==(i===0)&&(s=$(),U(s),V(!1),k=!0)}for(var E=new Set,I=ce,b=pe(),_=0;_<i;_+=1){C&&R.nodeType===oe&&R.data===ue&&(s=R,k=!0,V(!1));var x=c[_],y=u(x,_),v=h?null:m.get(y);v?(v.v&&K(v.v,x),v.i&&K(v.i,_),b&&I.unskip_effect(v.e)):(v=Le(m,h?s:Z??=G(),x,y,_,d,t,a),h||(v.e.f|=w),m.set(y,v)),E.add(y)}if(i===0&&n&&!f&&(h?f=J(()=>n(s)):(f=J(()=>n(Z??=G())),f.f|=w)),i>E.size&&de(),C&&i>0&&U($()),!h)if(b){for(const[re,ne]of m)E.has(re)||I.skip_effect(ne.e);I.oncommit(T),I.ondiscard(()=>{})}else T();k&&V(!0),X(N)}),r={effect:S,items:m,outrogroups:null,fallback:f};h=!1,C&&(s=R)}function L(e){for(;e!==null&&(e.f&we)===0;)e=e.next;return e}function Ce(e,t,a,u,d){var n=(u&Ae)!==0,s=t.length,m=e.items,l=L(e.effect.first),p,f=null,N,c=[],h=[],T,S,r,i;if(n)for(i=0;i<s;i+=1)T=t[i],S=d(T,i),r=m.get(S).e,(r.f&w)===0&&(r.nodes?.a?.measure(),(N??=new Set).add(r));for(i=0;i<s;i+=1){if(T=t[i],S=d(T,i),r=m.get(S).e,e.outrogroups!==null)for(const v of e.outrogroups)v.pending.delete(r),v.done.delete(r);if((r.f&w)!==0)if(r.f^=w,r===l)O(r,null,a);else{var k=f?f.next:l;r===e.effect.last&&(e.effect.last=r.prev),r.prev&&(r.prev.next=r.next),r.next&&(r.next.prev=r.prev),A(e,f,r),A(e,r,k),O(r,k,a),f=r,c=[],h=[],l=L(f.next);continue}if((r.f&Y)!==0&&(ee(r),n&&(r.nodes?.a?.unfix(),(N??=new Set).delete(r))),r!==l){if(p!==void 0&&p.has(r)){if(c.length<h.length){var D=h[0],E;f=D.prev;var I=c[0],b=c[c.length-1];for(E=0;E<c.length;E+=1)O(c[E],D,a);for(E=0;E<h.length;E+=1)p.delete(h[E]);A(e,I.prev,b.next),A(e,f,I),A(e,b,D),l=D,f=b,i-=1,c=[],h=[]}else p.delete(r),O(r,l,a),A(e,r.prev,r.next),A(e,r,f===null?e.effect.first:f.next),A(e,f,r),f=r;continue}for(c=[],h=[];l!==null&&l!==r;)(p??=new Set).add(l),h.push(l),l=L(l.next);if(l===null)continue}(r.f&w)===0&&c.push(r),f=r,l=L(r.next)}if(e.outrogroups!==null){for(const v of e.outrogroups)v.pending.size===0&&(P(Q(v.done)),e.outrogroups?.delete(v));e.outrogroups.size===0&&(e.outrogroups=null)}if(l!==null||p!==void 0){var _=[];if(p!==void 0)for(r of p)(r.f&Y)===0&&_.push(r);for(;l!==null;)(l.f&Y)===0&&l!==e.fallback&&_.push(l),l=L(l.next);var x=_.length;if(x>0){var y=(u&j)!==0&&s===0?a:null;if(n){for(i=0;i<x;i+=1)_[i].nodes?.a?.measure();for(i=0;i<x;i+=1)_[i].nodes?.a?.fix()}ye(e,_,y)}}n&&Ne(()=>{if(N!==void 0)for(r of N)r.nodes?.a?.apply()})}function Le(e,t,a,u,d,n,s,m){var l=(s&ge)!==0?(s&me)===0?_e(a,!1,!1):W(a):null,p=(s&Ee)!==0?W(d):null;return{v:l,i:p,e:J(()=>(n(t,l??a,p??d,m),()=>{e.delete(u)}))}}function O(e,t,a){if(e.nodes)for(var u=e.nodes.start,d=e.nodes.end,n=t&&(t.f&w)===0?t.nodes.start:a;u!==null;){var s=xe(u);if(n.before(u),u===d)return;u=s}}function A(e,t,a){t===null?e.effect.first=a:t.next=a,a===null?e.effect.last=t:a.prev=t}let g=Se({selectedTopic:"",selectedNoteName:"",selectedNoteId:"",cursorState:{}});(async()=>(g.selectedTopic=await H("selectedTopic")||"",g.selectedNoteName=await H("selectedNoteName")||"",g.selectedNoteId=await H("selectedNoteId")||"",g.cursorState=await H("cursorState")||{}))();function Be(){F(()=>{g.selectedTopic&&M("selectedTopic",g.selectedTopic)}),F(()=>{g.selectedNoteName&&M("selectedNoteName",g.selectedNoteName)}),F(()=>{g.selectedNoteId&&M("selectedNoteId",g.selectedNoteId)}),F(()=>{g.cursorState&&M("cursorState",ke(g.cursorState))})}function Ge(){let e=be.url.pathname.split("/").filter(Boolean);return e.unshift(De.triliumUrl),e.includes("topic")&&e.splice(e.indexOf("topic"),1,g.selectedTopic),e.includes("note")&&(e.splice(e.indexOf("note"),0,g.selectedTopic),e.splice(e.indexOf("note"),1,g.selectedNoteName)),e}let q=[],B=[];function Oe(e){q=q.filter(t=>t!==e)}function Ue(e){return q.push(e),()=>Oe(e)}function Re(e){B=B.filter(t=>t!==e)}function Ve(e){return B.push(e),()=>Re(e)}function o(e){q.forEach(t=>t(e))}function z(e){B.forEach(t=>t(e))}function Ye(){window.addEventListener("keydown",a=>{a.key=="3"&&(o("l2"),a.preventDefault()),a.key=="4"&&(o("l1"),a.preventDefault()),a.key=="7"&&(o("r1"),a.preventDefault()),a.key=="8"&&(o("r2"),a.preventDefault()),a.key=="ArrowUp"?(a.preventDefault(),o("up")):a.key=="ArrowDown"?(a.preventDefault(),o("down")):a.key=="ArrowLeft"?(a.preventDefault(),o("left")):a.key=="ArrowRight"?(a.preventDefault(),o("right")):a.key=="Enter"?(a.preventDefault(),o("confirm")):a.key=="Escape"&&(a.preventDefault(),o("cancel"))});let e={},t=()=>{var a=navigator.getGamepads();for(let u of a)u?.buttons&&(u.axes.forEach((d,n)=>{n==0&&z({axis:"lx",value:d}),n==1&&z({axis:"ly",value:d}),n==2&&z({axis:"rx",value:d}),n==3&&z({axis:"ry",value:d})}),u.buttons.forEach((d,n)=>{d.pressed?e[n]||(console.log("Pressed: "+n),n==8&&o("cancel"),n==1&&o("confirm"),n==4&&o("l1"),n==5&&o("r1"),n==6&&o("l2"),n==7&&o("r2"),n==12&&o("up"),n==13&&o("down"),n==14&&o("left"),n==15&&o("right"),e[n]=!0):e[n]=!1}));requestAnimationFrame(t)};requestAnimationFrame(t)}export{Ue as a,g as b,Ve as c,Ye as d,qe as e,Be as f,Ge as g,ze as i};
