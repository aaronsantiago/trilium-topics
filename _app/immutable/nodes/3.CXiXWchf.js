import{a as g,f as h}from"../chunks/0eLUwfcC.js";import{p as J,d as y,e as O,u as I,g as e,t as S,a as Q,c as m,s as v,h as d,r as p,i as W,b as D}from"../chunks/CL2eiML2.js";import{s as P}from"../chunks/B2RKNQ5a.js";import{i as X}from"../chunks/CrgOTeS3.js";import{a as ee,e as R,i as Y}from"../chunks/FmgtKzgn.js";import{r as te,s as se}from"../chunks/CQPD-vKY.js";import{b as oe}from"../chunks/nvgl6nZi.js";import{b as ae}from"../chunks/-G0STti-.js";import{K as ne}from"../chunks/DYGsEINx.js";import{t as A,d as F,a as k}from"../chunks/iG0XQOj0.js";import{g as M,b as T}from"../chunks/LGk_S0zR.js";import{l as E}from"../chunks/DmJvtKRS.js";var re=h('<span class="badge badge-primary mr-1"> </span>'),ie=h('<span class="badge badge-primary ml-1">âœ“</span>'),ce=h('<div class="outline-none focus:bg-secondary focus:text-secondary-content rounded px-2 py-1 cursor-pointer" tabindex="0"> <!></div>'),le=h('<div class="flex gap-4 w-screen p-4"><div class="flex-grow h-full overflow-hidden"><!></div> <div class="w-96 grid grid-cols-1 h-full overflow-y-auto"><input type="text" class="input input-bordered w-full" placeholder="Note title"/> <div></div> <button class="btn mt-2 btn-soft btn-primary outline-none focus:bg-secondary focus:text-secondary-content" tabindex="0" data-action="create">Create</button> <!></div></div>');function ye(U,H){J(H,!0);let i=y(""),n=y(null),c=y(O([]));I(()=>{e(n)&&e(n).focus()});async function K(s){if(document.activeElement!==e(n))return;const t=e(n)?.selectionStart??e(i).length,o=e(i).slice(0,t),a=e(i).slice(t),l=(o.length>0&&!o.endsWith(" ")?" ":"")+s+" ";d(i,o+l+a);const f=t+l.length;await W(),e(n)?.focus(),e(n)?.setSelectionRange(f,f)}async function L(){if(document.activeElement!==e(n))return;const s=e(n)?.selectionStart??e(i).length;let t=!0,o=0;for(let a=s-1;a>=0;a--){const r=e(i)[a],l=/\s/.test(r),f=!l&&/\W/.test(r);if(l){if(t){t=!1;continue}o=a;break}else if(f){if(t){o=a;break}o=a+1;break}else t=!1}d(i,e(i).slice(0,o)+e(i).slice(s)),await W(),e(n)?.focus(),e(n)?.setSelectionRange(o,o)}function V(){const s=e(n)?.selectionStart??0,t=e(i);let o=!0,a=0;for(let r=s-1;r>=0;r--){const l=t[r],f=/\s/.test(l),u=!f&&/\W/.test(l);if(f){if(o){o=!1;continue}a=r;break}else if(u){if(o){a=r;break}a=r+1;break}else o=!1}e(n)?.focus(),e(n)?.setSelectionRange(a,a)}function j(){const s=e(n)?.selectionStart??0,t=e(i);let o=!0,a=t.length;for(let r=s;r<t.length;r++){const l=t[r],f=/\s/.test(l),u=!f&&/\W/.test(l);if(f){if(o){o=!1;continue}a=r;break}else if(u){if(o){a=r+1;break}a=r;break}else o=!1}e(n)?.focus(),e(n)?.setSelectionRange(a,a)}function B(s){if(s==="left")document.activeElement!==e(n)?e(n)?.focus():V();else if(s==="right")if(document.activeElement!==e(n)){const t=E.getNextFocus(document.activeElement,"ArrowRight");t&&t.focus()}else j();else if(s==="up"){const t=E.getNextFocus(document.activeElement,"ArrowUp");t&&(t.focus(),t.scrollIntoView({behavior:"smooth",block:"nearest"}))}else if(s==="down"){const t=E.getNextFocus(document.activeElement,"ArrowDown");t&&(t.focus(),t.scrollIntoView({behavior:"smooth",block:"nearest"}))}}let Z=D(()=>(A.topicsDb?.children||[]).map(t=>t.title));async function $(){let s=crypto.randomUUID();A.createdNotes[s]={title:e(i),noteId:s,dateCreated:F().format("YYYY-MM-DD HH:mm:ss.SSS").concat(F().format("Z").replace(":","")),content:"",topics:e(c)},k.selectedTopic=e(c)[0],k.selectedNoteName=e(i),k.selectedNoteId=s,M(T+"/note")}I(()=>ee(s=>{if(["l1","l2","r1","r2"].includes(s)&&e(n)?.focus(),s==="confirm"){if(document.activeElement?.dataset?.action==="create"){if(e(i).trim()===""||e(c).length==0)return;$()}const t=document.activeElement?.dataset?.topic;t&&(e(c).includes(t)?d(c,e(c).filter(o=>o!==t),!0):d(c,[...e(c),t],!0))}s==="delete"&&document.activeElement!==e(n)&&d(c,e(c).slice(0,e(c).length-1),!0),s==="cancel"&&M(T+"/")}));var _=le(),x=m(_),q=m(x);ne(q,{onInsertWord:K,onDeleteWordBackward:L,onMoveCursor:B}),p(x);var N=v(x,2),b=m(N);te(b),ae(b,s=>d(n,s),()=>e(n));var w=v(b,2);R(w,21,()=>e(c),Y,(s,t)=>{var o=re(),a=m(o,!0);p(o),S(()=>P(a,e(t))),g(s,o)}),p(w);var C=v(w,2),z=v(C,2);R(z,17,()=>e(Z),Y,(s,t)=>{var o=ce(),a=m(o),r=v(a);{var l=u=>{var G=ie();g(u,G)},f=D(()=>e(c).includes(e(t)));X(r,u=>{e(f)&&u(l)})}p(o),S(()=>{se(o,"data-topic",e(t)),P(a,`${e(t)??""} `)}),g(s,o)}),p(N),p(_),S(s=>C.disabled=s,[()=>e(i).trim()===""||e(c).length==0]),oe(b,()=>e(i),s=>d(i,s)),g(U,_),Q()}export{ye as component};
