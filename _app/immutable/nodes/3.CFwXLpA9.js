import{d as Q,b as D,a as g,f as h}from"../chunks/Dif1b4kq.js";import{p as X,s as y,d as ee,u as P,g as e,t as S,a as te,c as m,e as v,h as u,r as p,i as R,b as T}from"../chunks/C8D-9BLl.js";import{s as Y}from"../chunks/BAVaMGux.js";import{i as oe}from"../chunks/jAm9DSX5.js";import{e as A,i as F}from"../chunks/vL8XQlbl.js";import{r as se,s as ae}from"../chunks/CeZXchYr.js";import{b as ne}from"../chunks/zrrswV7P.js";import{b as re}from"../chunks/Yjb4T9pC.js";import{K as ie}from"../chunks/q8d3fETX.js";import{a as ce}from"../chunks/DB7J5z9r.js";import{t as M,d as U,a as E}from"../chunks/BEpiyj4r.js";import{g as H,b as K}from"../chunks/Yj9vrk2x.js";import{l as N}from"../chunks/DmJvtKRS.js";var le=h('<span class="badge badge-primary mr-1"> </span>'),fe=h('<span class="badge badge-primary ml-1">âœ“</span>'),de=h('<div class="outline-none focus:bg-secondary focus:text-secondary-content rounded px-2 py-1 cursor-pointer" tabindex="0"> <!></div>'),ue=h('<div class="flex gap-4 w-screen p-4"><div class="flex-grow h-full overflow-hidden"><!></div> <div class="w-96 grid grid-cols-1 h-full overflow-y-auto"><input type="text" class="input input-bordered w-full" placeholder="Note title"/> <div></div> <button class="btn mt-2 btn-soft btn-primary outline-none focus:bg-secondary focus:text-secondary-content" tabindex="0" data-action="create">Create</button> <!></div></div>');function Ne(L,V){X(V,!0);let i=y(""),n=y(null),c=y(ee([]));P(()=>{e(n)&&e(n).focus()});async function j(t){if(document.activeElement!==e(n))return;const o=e(n)?.selectionStart??e(i).length,s=e(i).slice(0,o),a=e(i).slice(o),l=(s.length>0&&!s.endsWith(" ")?" ":"")+t+" ";u(i,s+l+a);const f=o+l.length;await R(),e(n)?.focus(),e(n)?.setSelectionRange(f,f)}async function B(){if(document.activeElement!==e(n))return;const t=e(n)?.selectionStart??e(i).length;let o=!0,s=0;for(let a=t-1;a>=0;a--){const r=e(i)[a],l=/\s/.test(r),f=!l&&/\W/.test(r);if(l){if(o){o=!1;continue}s=a;break}else if(f){if(o){s=a;break}s=a+1;break}else o=!1}u(i,e(i).slice(0,s)+e(i).slice(t)),await R(),e(n)?.focus(),e(n)?.setSelectionRange(s,s)}function Z(){const t=e(n)?.selectionStart??0,o=e(i);let s=!0,a=0;for(let r=t-1;r>=0;r--){const l=o[r],f=/\s/.test(l),d=!f&&/\W/.test(l);if(f){if(s){s=!1;continue}a=r;break}else if(d){if(s){a=r;break}a=r+1;break}else s=!1}e(n)?.focus(),e(n)?.setSelectionRange(a,a)}function $(){const t=e(n)?.selectionStart??0,o=e(i);let s=!0,a=o.length;for(let r=t;r<o.length;r++){const l=o[r],f=/\s/.test(l),d=!f&&/\W/.test(l);if(f){if(s){s=!1;continue}a=r;break}else if(d){if(s){a=r+1;break}a=r;break}else s=!1}e(n)?.focus(),e(n)?.setSelectionRange(a,a)}function q(t){if(t==="left")document.activeElement!==e(n)?e(n)?.focus():Z();else if(t==="right")if(document.activeElement!==e(n)){const o=N.getNextFocus(document.activeElement,"ArrowRight");o&&o.focus()}else $();else if(t==="up"){const o=N.getNextFocus(document.activeElement,"ArrowUp");o&&(o.focus(),o.scrollIntoView({behavior:"smooth",block:"nearest"}))}else if(t==="down"){const o=N.getNextFocus(document.activeElement,"ArrowDown");o&&(o.focus(),o.scrollIntoView({behavior:"smooth",block:"nearest"}))}}let z=T(()=>(M.topicsDb?.children||[]).map(o=>o.title));async function C(){let t=crypto.randomUUID();M.createdNotes[t]={title:e(i),noteId:t,dateCreated:U().format("YYYY-MM-DD HH:mm:ss.SSS").concat(U().format("Z").replace(":","")),content:"",topics:e(c)},E.selectedTopic=e(c)[0],E.selectedNoteName=e(i),E.selectedNoteId=t,H(K+"/note")}function I(){console.log("toggletopic called");const t=document.activeElement?.dataset?.topic;t&&(e(c).includes(t)?u(c,e(c).filter(o=>o!==t),!0):u(c,[...e(c),t],!0))}P(()=>ce(t=>{if(["l1","l2","r1","r2"].includes(t)&&e(n)?.focus(),t==="confirm")if(document.activeElement?.dataset?.action==="create"){if(e(i).trim()===""||e(c).length==0)return;C()}else document.activeElement?.dataset?.topic&&I();t==="delete"&&document.activeElement!==e(n)&&u(c,e(c).slice(0,e(c).length-1),!0),t==="cancel"&&H(K+"/")}));var _=ue(),x=m(_),G=m(x);ie(G,{onInsertWord:j,onDeleteWordBackward:B,onMoveCursor:q}),p(x);var W=v(x,2),b=m(W);se(b),re(b,t=>u(n,t),()=>e(n));var w=v(b,2);A(w,21,()=>e(c),F,(t,o)=>{var s=le(),a=m(s,!0);p(s),S(()=>Y(a,e(o))),g(t,s)}),p(w);var k=v(w,2),J=v(k,2);A(J,17,()=>e(z),F,(t,o)=>{var s=de(),a=m(s),r=v(a);{var l=d=>{var O=fe();g(d,O)},f=T(()=>e(c).includes(e(o)));oe(r,d=>{e(f)&&d(l)})}p(s),S(()=>{ae(s,"data-topic",e(o)),Y(a,`${e(o)??""} `)}),D("click",s,I),g(t,s)}),p(W),p(_),S(t=>k.disabled=t,[()=>e(i).trim()===""||e(c).length==0]),ne(b,()=>e(i),t=>u(i,t)),D("click",k,C),g(L,_),te()}Q(["click"]);export{Ne as component};
