import{d as dt,g as Y,b as k,a as g,f as x,c as pt}from"../chunks/D4MotnWR.js";import{p as mt,ag as p,ah as vt,ai as gt,u as bt,f as A,t as w,g as t,a as ht,c as S,s as b,aj as c,ak as _t,r as _,j as B,b as K}from"../chunks/17qEQskK.js";import{s as U}from"../chunks/D_hPu0to.js";import{i as V}from"../chunks/yuC0gQ1-.js";import{K as xt,k as yt,s as kt}from"../chunks/BJWtDJtB.js";import{e as G,i as X}from"../chunks/BGkeu9fO.js";import{s as Z,r as wt}from"../chunks/REneDJd4.js";import{b as St}from"../chunks/TKQQ8qR_.js";import{b as q}from"../chunks/Clv-RGyX.js";import{a as Et}from"../chunks/DB7J5z9r.js";import{t as J,d as O,a as z}from"../chunks/CFRkmxuC.js";import{g as Q,b as tt}from"../chunks/CUGRdALl.js";import{l as I}from"../chunks/DmJvtKRS.js";var Ct=x('<div class="custom-cursor svelte-jztt4t" aria-hidden="true"></div>'),jt=x('<span class="badge badge-primary mr-1 svelte-jztt4t"> </span>'),Nt=x('<span class="badge badge-primary ml-1 svelte-jztt4t">âœ“</span>'),Wt=x('<div class="outline-none focus:bg-secondary focus:text-secondary-content rounded px-2 py-1 cursor-pointer svelte-jztt4t" tabindex="0"> <!></div>'),zt=x('<!> <div class="w-full grid grid-cols-1 h-full overflow-y-auto svelte-jztt4t"><div class="relative svelte-jztt4t"><input type="text" class="input input-bordered w-full caret-transparent svelte-jztt4t" placeholder="Note title"/> <!></div> <div class="svelte-jztt4t"></div> <button class="btn mt-2 btn-soft btn-primary outline-none focus:bg-secondary focus:text-secondary-content svelte-jztt4t" tabindex="0" data-action="create">Create</button> <!></div>',1);function Kt(et,st){mt(st,!0);let i=p(""),n=p(null),f=p(vt([])),L=p(0),P=p(0),E=p(20),h=p(!1),D=p(0),H=p(null),C=p(!1);gt(()=>{t(n).addEventListener("pointerdown",e=>{c(C,!1)})});function v(){if(!t(n)){c(h,!1);return}try{const e=t(n).selectionStart??t(i).length,s=t(i).slice(0,e),o=getComputedStyle(t(n)),a=document.createElement("span");a.style.cssText=`position:absolute;visibility:hidden;white-space:pre;font:${o.font};letter-spacing:${o.letterSpacing};`,a.textContent=s,document.body.appendChild(a);const r=a.getBoundingClientRect().width;document.body.removeChild(a);const l=parseFloat(o.paddingLeft),u=parseFloat(o.borderLeftWidth),d=t(n).offsetHeight,W=parseFloat(o.lineHeight)||d;c(L,u+l+r-t(n).scrollLeft),c(E,Math.min(W,d*.7),!0),c(P,(d-t(E))/2),_t(D),c(h,!0)}catch{c(h,!1)}}async function ot(e){if(document.activeElement!==t(n))return;const s=t(n)?.selectionStart??t(i).length,o=t(i).slice(0,s),a=t(i).slice(s),l=(o.length>0&&!o.endsWith(" ")?" ":"")+e+" ";c(i,o+l+a);const u=s+l.length;await B(),t(n)?.focus(),t(n)?.setSelectionRange(u,u),v()}async function at(){if(document.activeElement!==t(n))return;const e=t(n)?.selectionStart??t(i).length;let s=!0,o=0;for(let a=e-1;a>=0;a--){const r=t(i)[a],l=/\s/.test(r),u=!l&&/\W/.test(r);if(l){if(s){s=!1;continue}o=a;break}else if(u){if(s){o=a;break}o=a+1;break}else s=!1}c(i,t(i).slice(0,o)+t(i).slice(e)),await B(),t(n)?.focus(),t(n)?.setSelectionRange(o,o),v()}function nt(){const e=t(n)?.selectionStart??0,s=t(i);let o=!0,a=0;for(let r=e-1;r>=0;r--){const l=s[r],u=/\s/.test(l),d=!u&&/\W/.test(l);if(u){if(o){o=!1;continue}a=r;break}else if(d){if(o){a=r;break}a=r+1;break}else o=!1}t(n)?.focus(),t(n)?.setSelectionRange(a,a),v()}function rt(){const e=t(n)?.selectionStart??0,s=t(i);let o=!0,a=s.length;for(let r=e;r<s.length;r++){const l=s[r],u=/\s/.test(l),d=!u&&/\W/.test(l);if(u){if(o){o=!1;continue}a=r;break}else if(d){if(o){a=r+1;break}a=r;break}else o=!1}t(n)?.focus(),t(n)?.setSelectionRange(a,a),v()}function it(e){if(e==="left")document.activeElement!==t(n)?t(n)?.focus():nt();else if(e==="right")if(document.activeElement!==t(n)){const s=I.getNextFocus(document.activeElement,"ArrowRight");s&&s.focus()}else rt();else if(e==="up"){const s=I.getNextFocus(document.activeElement,"ArrowUp");s&&(s.focus(),s.scrollIntoView({behavior:"smooth",block:"nearest"}))}else if(e==="down"){const s=I.getNextFocus(document.activeElement,"ArrowDown");s&&(s.focus(),s.scrollIntoView({behavior:"smooth",block:"nearest"}))}}let ct=K(()=>(J.topicsDb?.children||[]).map(s=>s.title));async function R(){let e=crypto.randomUUID();J.createdNotes[e]={title:t(i),noteId:e,dateCreated:O().format("YYYY-MM-DD HH:mm:ss.SSS").concat(O().format("Z").replace(":","")),content:"",topics:t(f)},z.selectedTopic=t(f)[0],z.selectedNoteName=t(i),z.selectedNoteId=e,Q(tt+"/note")}function F(){console.log("toggletopic called");const e=document.activeElement?.dataset?.topic;e&&(t(f).includes(e)?c(f,t(f).filter(s=>s!==e),!0):c(f,[...t(f),e],!0))}bt(()=>Et(e=>{if(c(C,!0),["l1","l2","r1","r2"].includes(e)&&(t(n)?.focus(),v()),e==="confirm")if(document.activeElement?.dataset?.action==="create"){if(t(i).trim()===""||t(f).length==0)return;R()}else document.activeElement?.dataset?.topic&&F();e==="delete"&&document.activeElement!==t(n)&&c(f,t(f).slice(0,t(f).length-1),!0),e==="cancel"&&Q(tt+"/")}));var $=zt(),M=A($);xt(M,{onInsertWord:ot,onDeleteWordBackward:at,onMoveCursor:it});var T=b(M,2),y=S(T),m=S(y);wt(m),q(m,e=>c(n,e),()=>t(n));var lt=b(m,2);{var ft=e=>{var s=pt(),o=A(s);yt(o,()=>t(D),a=>{var r=Ct();w(()=>kt(r,`left: ${t(L)??""}px; top: ${t(P)??""}px; height: ${t(E)??""}px;`)),g(a,r)}),g(e,s)};V(lt,e=>{t(h)&&e(ft)})}_(y),q(y,e=>c(H,e),()=>t(H));var j=b(y,2);G(j,21,()=>t(f),X,(e,s)=>{var o=jt(),a=S(o,!0);_(o),w(()=>U(a,t(s))),g(e,o)}),_(j);var N=b(j,2),ut=b(N,2);G(ut,17,()=>t(ct),X,(e,s)=>{var o=Wt(),a=S(o),r=b(a);{var l=d=>{var W=Nt();g(d,W)},u=K(()=>t(f).includes(t(s)));V(r,d=>{t(u)&&d(l)})}_(o),w(()=>{Z(o,"data-topic",t(s)),U(a,`${t(s)??""} `)}),k("click",o,F),g(e,o)}),_(T),w(e=>{Z(m,"inputmode",t(C)?"none":null),N.disabled=e},[()=>t(i).trim()===""||t(f).length==0]),Y("focus",m,()=>v()),k("click",m,()=>v()),k("keyup",m,()=>v()),Y("blur",m,()=>{c(h,!1)}),St(m,()=>t(i),e=>c(i,e)),k("click",N,R),g(et,$),ht()}dt(["click","keyup"]);export{Kt as component};
