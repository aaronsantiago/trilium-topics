import{a as k,f as W}from"../chunks/BgnR6MGh.js";import{p as J,d as b,e as O,u as P,h as f,g as e,t as N,a as Q,b as X,c as m,s as g,r as p,i as D}from"../chunks/BookdCrg.js";import{s as M}from"../chunks/COYhqng1.js";import{a as $,e as R,i as Y}from"../chunks/DLfwuNK-.js";import{r as ee}from"../chunks/C4UscxPu.js";import{s as T,c as te}from"../chunks/C0C3IxD_.js";import{b as se}from"../chunks/Cwlj4ZGg.js";import{b as oe}from"../chunks/CkVpw6UV.js";import{K as re}from"../chunks/D4jilHmW.js";import{t as H,d as K,a as C}from"../chunks/CI73C_kc.js";import{g as L,b as U}from"../chunks/Cz4Ciohr.js";var ae=W('<span class="badge badge-primary mr-1"> </span>'),ie=W("<div> </div>"),ne=W('<div class="flex gap-4 w-screen p-4"><div class="flex-grow h-full overflow-hidden"><!></div> <div class="w-96 grid grid-cols-1 h-full overflow-y-auto"><input type="text" class="input input-bordered w-full" placeholder="Note title"/> <div></div> <button>Create</button> <!></div></div>');function _e(j,q){J(q,!0);let n=b(""),l=b(null),a=b(0),c=b(O([]));async function B(t){if(e(a)>0)return;const r=e(l)?.selectionStart??e(n).length,s=e(n).slice(0,r),o=e(n).slice(r),u=(s.length>0&&!s.endsWith(" ")?" ":"")+t+" ";f(n,s+u+o);const d=r+u.length;await D(),e(l)?.focus(),e(l)?.setSelectionRange(d,d)}async function E(){if(e(a)>0)return;const t=e(l)?.selectionStart??e(n).length;let r=!0,s=0;for(let o=t-1;o>=0;o--){const i=e(n)[o],u=/\s/.test(i),d=!u&&/\W/.test(i);if(u){if(r){r=!1;continue}s=o;break}else if(d){if(r){s=o;break}s=o+1;break}else r=!1}f(n,e(n).slice(0,s)+e(n).slice(t)),await D(),e(l)?.focus(),e(l)?.setSelectionRange(s,s)}function V(){if(e(a)>0)return;const t=e(l)?.selectionStart??0,r=e(n);let s=!0,o=0;for(let i=t-1;i>=0;i--){const u=r[i],d=/\s/.test(u),y=!d&&/\W/.test(u);if(d){if(s){s=!1;continue}o=i;break}else if(y){if(s){o=i;break}o=i+1;break}else s=!1}e(l)?.focus(),e(l)?.setSelectionRange(o,o)}function Z(){if(e(a)>0)return;const t=e(l)?.selectionStart??0,r=e(n);let s=!0,o=r.length;for(let i=t;i<r.length;i++){const u=r[i],d=/\s/.test(u),y=!d&&/\W/.test(u);if(d){if(s){s=!1;continue}o=i;break}else if(y){if(s){o=i+1;break}o=i;break}else s=!1}e(l)?.focus(),e(l)?.setSelectionRange(o,o)}function z(t){t==="left"?e(a)>0?f(a,0):V():t==="right"?Z():t==="up"?f(a,e(a)-1):t==="down"&&f(a,e(a)+1)}let v=X(()=>(H.topicsDb?.children||[]).map(r=>r.title));async function A(){let t=crypto.randomUUID();H.createdNotes[t]={title:e(n),noteId:t,dateCreated:K().format("YYYY-MM-DD HH:mm:ss.SSS").concat(K().format("Z").replace(":","")),content:"",topics:e(c)},C.selectedTopic=e(c)[0],C.selectedNoteName=e(n),C.selectedNoteId=t,L(U+"/note")}P(()=>$(t=>{if(["l1","l2","r1","r2"].includes(t)&&f(a,0),t==="confirm"){if(e(a)==1){if(e(n).trim()===""||e(c).length==0)return;A()}if(e(a)>1){const r=e(v)[e(a)-2];e(c).includes(r)?f(c,e(c).filter(s=>s!==r),!0):f(c,[...e(c),r],!0)}}t==="delete"&&e(a)>0&&f(c,e(c).slice(0,e(c).length-1),!0),t==="cancel"&&L(U+"/")})),P(()=>{if(f(a,Math.max(0,Math.min(e(a),e(v).length+2)),!0),e(a)==0)e(l)?.focus();else{e(l)?.blur();const t=document.querySelector("#topic_"+e(v)[e(a)-2]);t&&t.scrollIntoView({behavior:"smooth",block:"nearest"})}});var _=ne(),S=m(_),F=m(S);re(F,{onInsertWord:B,onDeleteWordBackward:E,onMoveCursor:z}),p(S);var I=g(S,2),h=m(I);ee(h),oe(h,t=>f(l,t),()=>e(l));var w=g(h,2);R(w,21,()=>e(c),Y,(t,r)=>{var s=ae(),o=m(s,!0);p(s),N(()=>M(o,e(r))),k(t,s)}),p(w);var x=g(w,2),G=g(x,2);R(G,17,()=>e(v),Y,(t,r,s)=>{var o=ie(),i=m(o,!0);p(o),N(()=>{T(o,1,te(s+2===e(a)?"border":"")),M(i,e(r))}),k(t,o)}),p(I),p(_),N(t=>{T(x,1,"btn mt-2 btn-soft"+(e(a)==1?" btn-secondary":" btn-primary")),x.disabled=t},[()=>e(n).trim()===""||e(c).length==0]),se(h,()=>e(n),t=>f(n,t)),k(j,_),Q()}export{_e as component};
